
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>mongo-spark-connector使用说明 | wzktravel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="mongoDB的spark connector使用说明，mongo版本为2.6.12，spark版本为1.6.0。官网为https://docs.mongodb.com/spark-connector/。">
<meta property="og:type" content="article">
<meta property="og:title" content="mongo-spark-connector使用说明">
<meta property="og:url" content="http://wzktravel.github.io/2016/10/20/use-mongo-spark-connector/index.html">
<meta property="og:site_name" content="wzktravel">
<meta property="og:description" content="mongoDB的spark connector使用说明，mongo版本为2.6.12，spark版本为1.6.0。官网为https://docs.mongodb.com/spark-connector/。">
<meta property="og:updated_time" content="2016-10-20T10:49:02.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mongo-spark-connector使用说明">
<meta name="twitter:description" content="mongoDB的spark connector使用说明，mongo版本为2.6.12，spark版本为1.6.0。官网为https://docs.mongodb.com/spark-connector/。">
  
    <link rel="alternative" href="/atom.xml" title="wzktravel" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--<link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">-->
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  <!-- -->
  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>

<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">wzktravel</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="wzktravel.github.io">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-use-mongo-spark-connector" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/20/use-mongo-spark-connector/" class="article-date">
  <time datetime="2016-10-20T10:39:51.000Z" itemprop="datePublished">2016-10-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      mongo-spark-connector使用说明
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>mongoDB&#x7684;spark connector&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#xFF0C;mongo&#x7248;&#x672C;&#x4E3A;2.6.12&#xFF0C;spark&#x7248;&#x672C;&#x4E3A;1.6.0&#x3002;&#x5B98;&#x7F51;&#x4E3A;<a href="https://docs.mongodb.com/spark-connector/" target="_blank" rel="external">https://docs.mongodb.com/spark-connector/</a>&#x3002;<br><a id="more"></a></p>
<h2 id="getting-started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><p><a href="https://docs.mongodb.com/spark-connector/getting-started/" target="_blank" rel="external">https://docs.mongodb.com/spark-connector/getting-started/</a></p>
<h3 id="&#x542F;&#x52A8;spark-shell"><a href="#&#x542F;&#x52A8;spark-shell" class="headerlink" title="&#x542F;&#x52A8;spark-shell"></a>&#x542F;&#x52A8;spark-shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">spark-shell --conf <span class="string">&quot;spark.mongodb.input.uri=mongodb://192.168.2.12/fs-form.form?readPreference=primaryPreferred&quot;</span> \</div><div class="line">            --conf <span class="string">&quot;spark.mongodb.output.uri=mongodb://192.168.2.12/mydb.test4&quot;</span> \</div><div class="line">            --packages org.mongodb.spark:mongo-spark-connector_2.10:1.1.0</div></pre></td></tr></table></figure>
<p><code>--packages</code>&#x4F1A;&#x81EA;&#x52A8;&#x4E0B;&#x8F7D;&#x4F9D;&#x8D56;&#x5305;</p>
<h3 id="&#x5411;mongo&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;"><a href="#&#x5411;Mongo&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;" class="headerlink" title="&#x5411;Mongo&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;"></a>&#x5411;Mongo&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;</h3><p>&#x53C2;&#x8003;<a href="https://docs.mongodb.com/spark-connector/getting-started/#write-to-mongodb" target="_blank" rel="external">https://docs.mongodb.com/spark-connector/getting-started/#write-to-mongodb</a></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">import</span> com.mongodb.spark._    <span class="comment">//import MongoDB connector package</span></div><div class="line">scala&gt; <span class="keyword">import</span> com.mongodb.spark.config._ </div><div class="line">scala&gt; <span class="keyword">import</span> org.bson.<span class="type">Document</span>      <span class="comment">//import bson </span></div><div class="line">scala&gt; <span class="keyword">val</span> sparkDocuments = sc.parallelize((<span class="number">1</span> to <span class="number">10</span>).map(i =&gt; <span class="type">Document</span>.parse(<span class="string">s&quot;{spark: <span class="subst">$i</span>}&quot;</span>)))</div><div class="line">scala&gt; sparkDocuments.saveToMongoDB(<span class="type">WriteConfig</span>(<span class="type">Map</span>(<span class="string">&quot;uri&quot;</span> -&gt; <span class="string">&quot;mongodb://192.168.2.12/mydb.test4&quot;</span>))) <span class="comment">// Uses the WriteConfig</span></div></pre></td></tr></table></figure>
<p>&#x4FDD;&#x5B58;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x5F62;&#x5F0F;<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> writeConfig = <span class="type">WriteConfig</span>(<span class="type">Map</span>(<span class="string">&quot;collection&quot;</span> -&gt; <span class="string">&quot;spark&quot;</span>, <span class="string">&quot;writeConcern.w&quot;</span> -&gt; <span class="string">&quot;majority&quot;</span>), <span class="type">Some</span>(<span class="type">WriteConfig</span>(sc)))</div><div class="line">scala&gt; <span class="type">MongoSpark</span>.save(sparkDocuments, writeConfig)</div></pre></td></tr></table></figure></p>
<p>&#x67E5;&#x770B;mongo&#x4E2D;&#x6570;&#x636E;:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">StandAlone:PRIMARY&gt; db.test4.find()</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f7ab0584e&quot;), &quot;spark&quot; : 6 }</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f7ab0584f&quot;), &quot;spark&quot; : 7 }</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f64d99533&quot;), &quot;spark&quot; : 1 }</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f7ab05850&quot;), &quot;spark&quot; : 8 }</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f64d99534&quot;), &quot;spark&quot; : 2 }</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f7ab05851&quot;), &quot;spark&quot; : 9 }</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f64d99535&quot;), &quot;spark&quot; : 3 }</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f7ab05852&quot;), &quot;spark&quot; : 10 }</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f64d99536&quot;), &quot;spark&quot; : 4 }</div><div class="line">{ &quot;_id&quot; : ObjectId(&quot;58086a308ad6b14f64d99537&quot;), &quot;spark&quot; : 5 }</div></pre></td></tr></table></figure></p>
<h3 id="&#x4ECE;mongo&#x4E2D;&#x8BFB;&#x53D6;&#x5E76;&#x5206;&#x6790;&#x6570;&#x636E;"><a href="#&#x4ECE;Mongo&#x4E2D;&#x8BFB;&#x53D6;&#x5E76;&#x5206;&#x6790;&#x6570;&#x636E;" class="headerlink" title="&#x4ECE;Mongo&#x4E2D;&#x8BFB;&#x53D6;&#x5E76;&#x5206;&#x6790;&#x6570;&#x636E;"></a>&#x4ECE;Mongo&#x4E2D;&#x8BFB;&#x53D6;&#x5E76;&#x5206;&#x6790;&#x6570;&#x636E;</h3><p>&#x5982;&#x679C;mongo&#x7248;&#x672C;&#x4F4E;&#x4E8E;3.2&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;<code>MongoSpark.load(sc)</code>&#x4F1A;&#x62A5;&#x9519;&#xFF0C;<code>ERROR partitioner.DefaultMongoPartitioner</code>&#x3002;&#x9700;&#x8981;&#x4F7F;&#x7528;ReadConfig&#xFF0C;&#x6307;&#x5B9A;<code>partitioner</code>&#x53C2;&#x6570;&#x3002;</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> readConfig = <span class="type">ReadConfig</span>(<span class="type">Map</span>(<span class="string">&quot;database&quot;</span> -&gt; <span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;collection&quot;</span> -&gt; <span class="string">&quot;test4&quot;</span>, <span class="string">&quot;partitioner&quot;</span> -&gt; <span class="string">&quot;MongoShardedPartitioner&quot;</span>), <span class="type">Some</span>(<span class="type">ReadConfig</span>(sc)))</div><div class="line">readConfig: com.mongodb.spark.config.<span class="type">ReadConfig</span> = <span class="type">ReadConfig</span>(mydb,test4,<span class="type">Some</span>(mongodb:<span class="comment">//192.168.2.12/fs-form.form?readPreference=primaryPreferred),1000,com.mongodb.spark.rdd.partitioner.MongoShardedPartitioner@368e1bf3,Map(),15,ReadPreferenceConfig(primaryPreferred,None),ReadConcernConfig(None),false)</span></div><div class="line">scala&gt; <span class="keyword">val</span> customRdd = <span class="type">MongoSpark</span>.load(sc, readConfig)</div><div class="line">scala&gt; println(customRdd.first.toJson)</div><div class="line">{ <span class="string">&quot;_id&quot;</span> : { <span class="string">&quot;$oid&quot;</span> : <span class="string">&quot;58086a308ad6b14f64d99533&quot;</span> }, <span class="string">&quot;spark&quot;</span> : <span class="number">1</span> }</div></pre></td></tr></table></figure>
<p>&#x6216;&#x76F4;&#x63A5;&#x4F7F;&#x7528;<code>sc.loadFromMongoDB(ReadConfig)</code>&#x3002;</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.loadFromMongoDB(<span class="type">ReadConfig</span>(<span class="type">Map</span>(<span class="string">&quot;uri&quot;</span> -&gt; <span class="string">&quot;mongodb://192.168.2.12/mydb.test4&quot;</span>, <span class="string">&quot;partitioner&quot;</span> -&gt; <span class="string">&quot;MongoShardedPartitioner&quot;</span>)))</div><div class="line">scala&gt; println(rdd.first.toJson)</div><div class="line">{ <span class="string">&quot;_id&quot;</span> : { <span class="string">&quot;$oid&quot;</span> : <span class="string">&quot;58086a308ad6b14f64d99533&quot;</span> }, <span class="string">&quot;spark&quot;</span> : <span class="number">1</span> }</div></pre></td></tr></table></figure>
<h2 id="spark-sql"><a href="#Spark-SQL" class="headerlink" title="Spark SQL"></a>Spark SQL</h2><p><a href="https://docs.mongodb.com/spark-connector/spark-sql/" target="_blank" rel="external">https://docs.mongodb.com/spark-connector/spark-sql/</a></p>
<p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;spark&#x662F;1.6.0&#xFF0C;&#x800C;SparkSession&#x662F;Spark2.0&#x5F15;&#x5165;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x80FD;&#x53C2;&#x8003;master&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;<a href="https://github.com/mongodb/mongo-spark/blob/1.x/examples/src/test/scala/tour/SparkSQL.scala" target="_blank" rel="external">https://github.com/mongodb/mongo-spark/blob/1.x/examples/src/test/scala/tour/SparkSQL.scala</a></p>
<h3 id="&#x4F7F;&#x7528;dataframe"><a href="#&#x4F7F;&#x7528;DataFrame" class="headerlink" title="&#x4F7F;&#x7528;DataFrame"></a>&#x4F7F;&#x7528;DataFrame</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">import</span> org.apache.spark.sql.<span class="type">SQLContext</span></div><div class="line">scala&gt; <span class="keyword">import</span> com.mongodb.spark._</div><div class="line">scala&gt; <span class="keyword">import</span> com.mongodb.spark.config._</div><div class="line">scala&gt; <span class="keyword">import</span> com.mongodb.spark.sql._</div><div class="line">scala&gt; <span class="keyword">import</span> org.bson.<span class="type">Document</span></div><div class="line"></div><div class="line">scala&gt; <span class="keyword">val</span> sqlContext = <span class="type">SQLContext</span>.getOrCreate(sc)</div><div class="line">scala&gt; <span class="keyword">val</span> df = sqlContext.loadFromMongoDB(<span class="type">ReadConfig</span>(<span class="type">Map</span>(<span class="string">&quot;uri&quot;</span> -&gt; <span class="string">&quot;mongodb://192.168.2.12/mydb.test4&quot;</span>, <span class="string">&quot;partitioner&quot;</span> -&gt; <span class="string">&quot;MongoShardedPartitioner&quot;</span>)))</div><div class="line">scala&gt; df.filter(df(<span class="string">&quot;age&quot;</span>) &lt; <span class="number">100</span>).show() </div><div class="line">+--------------------+---+-------------+</div><div class="line">|                 _id|age|         name|</div><div class="line">+--------------------+---+-------------+</div><div class="line">|[<span class="number">58087</span>ec39a1ca7ec...| <span class="number">50</span>|<span class="type">Bilbo</span> <span class="type">Baggins</span>|</div><div class="line">|[<span class="number">58087</span>ec39a1ca7ec...| <span class="number">77</span>|         <span class="type">K</span>&#xED;li|</div><div class="line">|[<span class="number">58087</span>ec49a1ca7ec...| <span class="number">82</span>|         <span class="type">F</span>&#xED;li|</div><div class="line">+--------------------+---+-------------+</div></pre></td></tr></table></figure>
<h3 id="&#x663E;&#x5F0F;&#x4F7F;&#x7528;dataframe&#x548C;dataset"><a href="#&#x663E;&#x5F0F;&#x4F7F;&#x7528;DataFrame&#x548C;DataSet" class="headerlink" title="&#x663E;&#x5F0F;&#x4F7F;&#x7528;DataFrame&#x548C;DataSet"></a>&#x663E;&#x5F0F;&#x4F7F;&#x7528;DataFrame&#x548C;DataSet</h3><p>&#x76F4;&#x63A5;&#x4ECE;mongo&#x8BFB;&#x53D6;&#x65F6;&#x88C5;&#x8F7D;&#x4E3A;DataFrame<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Character</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span></span>)</span></div><div class="line">scala&gt; <span class="keyword">val</span> sqlContext = <span class="type">SQLContext</span>.getOrCreate(sc)</div><div class="line">scala&gt; <span class="keyword">val</span> df = sqlContext.loadFromMongoDB[<span class="type">Character</span>](<span class="type">ReadConfig</span>(<span class="type">Map</span>(<span class="string">&quot;uri&quot;</span> -&gt; <span class="string">&quot;mongodb://192.168.2.12/mydb.test4&quot;</span>, <span class="string">&quot;partitioner&quot;</span> -&gt; <span class="string">&quot;MongoShardedPartitioner&quot;</span>)))</div><div class="line">scala&gt; df.printSchema()</div><div class="line">root</div><div class="line"> |-- name: string (nullable = <span class="literal">true</span>)</div><div class="line"> |-- age: integer (nullable = <span class="literal">false</span>)</div><div class="line">scala&gt; <span class="keyword">val</span> dataset = df.as[<span class="type">Character</span>]</div></pre></td></tr></table></figure></p>
<p>&#x6216;&#x4ECE;RDD&#x8F6C;&#x6362;&#x4E3A;DataFrame&#x6216;DataSet<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.loadFromMongoDB(<span class="type">ReadConfig</span>(<span class="type">Map</span>(<span class="string">&quot;uri&quot;</span> -&gt; <span class="string">&quot;mongodb://192.168.2.12/mydb.test4&quot;</span>, <span class="string">&quot;partitioner&quot;</span> -&gt; <span class="string">&quot;MongoShardedPartitioner&quot;</span>)))</div><div class="line">scala&gt; <span class="keyword">val</span> dfInferredSchema = rdd.toDF()</div><div class="line">scala&gt; <span class="keyword">val</span> dfExplicitSchema = rdd.toDF[<span class="type">Character</span>]()</div><div class="line">scala&gt; <span class="keyword">val</span> ds = rdd.toDS[<span class="type">Character</span>]()</div></pre></td></tr></table></figure></p>
<h3 id="&#x4F7F;&#x7528;spark-sql"><a href="#&#x4F7F;&#x7528;Spark-SQL" class="headerlink" title="&#x4F7F;&#x7528;Spark SQL"></a>&#x4F7F;&#x7528;Spark SQL</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> sqlContext = <span class="type">SQLContext</span>.getOrCreate(sc)</div><div class="line">scala&gt; <span class="keyword">val</span> df = sqlContext.loadFromMongoDB(<span class="type">ReadConfig</span>(<span class="type">Map</span>(<span class="string">&quot;uri&quot;</span> -&gt; <span class="string">&quot;mongodb://192.168.2.12/mydb.test4&quot;</span>, <span class="string">&quot;partitioner&quot;</span> -&gt; <span class="string">&quot;MongoShardedPartitioner&quot;</span>)))</div><div class="line">scala&gt; df.registerTempTable(<span class="string">&quot;characters&quot;</span>)</div><div class="line">scala&gt; sqlContext.sql(<span class="string">&quot;SELECT * FROM test6 WHERE age &gt;= 100 and age &lt; 170&quot;</span>).show()</div><div class="line">+------+---+</div><div class="line">|  name|age|</div><div class="line">+------+---+</div><div class="line">|<span class="type">Dwalin</span>|<span class="number">169</span>|</div><div class="line">|   &#xD3;in|<span class="number">167</span>|</div><div class="line">| <span class="type">Gl</span>&#xF3;in|<span class="number">158</span>|</div><div class="line">+------+---+</div></pre></td></tr></table></figure>
<h2 id="exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h2><h3 id="error-partitionerdefaultmongopartitioner"><a href="#ERROR-partitioner-DefaultMongoPartitioner" class="headerlink" title="ERROR partitioner.DefaultMongoPartitioner"></a>ERROR partitioner.DefaultMongoPartitioner</h3><p>mongodb&#x7248;&#x672C;&#x4F4E;&#x4E8E;3.2&#x65F6;&#xFF0C;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x65F6;&#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A;ReadConfig&#x4E2D;<code>partitioner</code>&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684;<code>DefaultMongoPartitioner</code>&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x4F1A;&#x62A5;&#x9519;&#x3002;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">16/10/20 15:12:39 ERROR partitioner.DefaultMongoPartitioner:</div><div class="line">----------------------------------------</div><div class="line">WARNING: MongoDB version &lt; 3.2 detected.</div><div class="line">----------------------------------------</div><div class="line"></div><div class="line">With legacy MongoDB installations you will need to explicitly configure the Spark Connector with a partitioner.</div><div class="line"></div><div class="line">This can be done by:</div><div class="line"> * Setting a &quot;spark.mongodb.input.partitioner&quot; in SparkConf.</div><div class="line"> * Setting in the &quot;partitioner&quot; parameter in ReadConfig.</div><div class="line"> * Passing the &quot;partitioner&quot; option to the DataFrameReader.</div><div class="line"></div><div class="line">The following Partitioners are available:</div><div class="line"></div><div class="line"> * MongoShardedPartitioner - for sharded clusters, requires read access to the config database.</div><div class="line"> * MongoSplitVectorPartitioner - for single nodes or replicaSets. Utilises the SplitVector command on the primary.</div><div class="line"> * MongoPaginateByCountPartitioner - creates a specific number of partitions. Slow as requires a query for every partition.</div><div class="line"> * MongoPaginateBySizePartitioner - creates partitions based on data size. Slow as requires a query for every partition.</div></pre></td></tr></table></figure></p>
<p>&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x7ED9;&#x51FA;&#x7684;&#x63D0;&#x793A;&#x6BD4;&#x8F83;&#x660E;&#x663E;&#xFF0C;<code>DefaultMongoPartitioner</code>&#x5728;3.2&#x624D;&#x4F1A;&#x5B58;&#x5728;&#xFF0C;&#x9700;&#x8981;&#x6307;&#x5B9A;<code>partitioner</code>&#x4E3A;&#x5176;&#x4ED6;&#x51E0;&#x79CD;&#x3002;</p>
<ul>
<li>ReadConfig&#x914D;&#x7F6E;&#x9879;: <a href="https://docs.mongodb.com/spark-connector/configuration/#input-configuration" target="_blank" rel="external">https://docs.mongodb.com/spark-connector/configuration/#input-configuration</a></li>
<li>Partitioner&#x914D;&#x7F6E;&#x9879;: <a href="https://docs.mongodb.com/spark-connector/configuration/#partitioner-conf" target="_blank" rel="external">https://docs.mongodb.com/spark-connector/configuration/#partitioner-conf</a></li>
</ul>
<h2 id="&#x5B89;&#x88C5;mongo"><a href="#&#x5B89;&#x88C5;mongo" class="headerlink" title="&#x5B89;&#x88C5;mongo"></a>&#x5B89;&#x88C5;mongo</h2><p>&#x53C2;&#x8003;<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/" target="_blank" rel="external">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/</a></p>
<h3 id="&#x6DFB;&#x52A0;mongo26-repo"><a href="#&#x6DFB;&#x52A0;mongo2-6-repo" class="headerlink" title="&#x6DFB;&#x52A0;mongo2.6 repo"></a>&#x6DFB;&#x52A0;mongo2.6 repo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cat &gt; /etc/yum.repos.d/mongodb-org-2.6.repo</div><div class="line">[mongodb-org-2.6]</div><div class="line">name=MongoDB 2.6 Repository</div><div class="line">baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64/</div><div class="line">gpgcheck=0</div><div class="line">enabled=1</div></pre></td></tr></table></figure>
<h3 id="&#x8FDB;&#x884C;&#x5B89;&#x88C5;"><a href="#&#x8FDB;&#x884C;&#x5B89;&#x88C5;" class="headerlink" title="&#x8FDB;&#x884C;&#x5B89;&#x88C5;"></a>&#x8FDB;&#x884C;&#x5B89;&#x88C5;</h3><ul>
<li><p>&#x5B89;&#x88C5;&#x6240;&#x6709;&#x5305;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install -y mongodb-org</div></pre></td></tr></table></figure>
</li>
<li><p>&#x53EA;&#x5B89;&#x88C5;shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install -y mongodb-org-shell</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><ol>
<li><a href="http://blog.csdn.net/zxkln/article/details/6114793" target="_blank" rel="external">mongo shell&#x5E38;&#x7528;&#x547D;&#x4EE4;</a></li>
<li><a href="https://docs.mongodb.com/spark-connector/" target="_blank" rel="external">MongoDB Connector for Spark</a></li>
<li><a href="http://www.jianshu.com/p/c0181667daa0" target="_blank" rel="external">RDD, DataFrame, DataSet&#x533A;&#x522B;</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://wzktravel.github.io/2016/10/20/use-mongo-spark-connector/" data-id="civ7xxrte003i5v9k2jfklqtv" class="article-share-link" data-share="baidu" data-title="mongo-spark-connector使用说明">分享到</a>
      

      
        <a href="http://wzktravel.github.io/2016/10/20/use-mongo-spark-connector/#ds-thread" class="article-comment-link">评论</a>
      

      
        <span id="busuanzi_container_page_pv" style='display:none;float:right;margin-right:20px;color:#999;'>view <span id="busuanzi_value_page_pv"></span> times</span>
      
  
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongo/">mongo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spark/">spark</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/10/20/use-local-maven-repository-faster-sbt/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          使用本地maven私服加速sbt下载
        
      </div>
    </a>
  
  
    <a href="/2016/09/29/check-linux-and-kernel-version/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">查看linux发行版本和kernel版本</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="2016/10/20/use-mongo-spark-connector/" data-title="mongo-spark-connector使用说明" data-url="http://wzktravel.github.io/2016/10/20/use-mongo-spark-connector/"></div>
  </section>

</section>
      
      <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/azkaban/">azkaban</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cdh/">cdh</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hbase/">hbase</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdfs/">hdfs</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jodatime/">jodatime</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kerberos/">kerberos</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongo/">mongo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgres/">postgres</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/quartz/">quartz</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sbt/">sbt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/schedule/">schedule</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sentry/">sentry</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/">spark</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thread/">thread</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yarn/">yarn</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/azkaban/" style="font-size: 10px;">azkaban</a> <a href="/tags/cdh/" style="font-size: 16.25px;">cdh</a> <a href="/tags/elasticsearch/" style="font-size: 12.5px;">elasticsearch</a> <a href="/tags/flume/" style="font-size: 11.25px;">flume</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 11.25px;">github</a> <a href="/tags/hadoop/" style="font-size: 20px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 11.25px;">hbase</a> <a href="/tags/hdfs/" style="font-size: 12.5px;">hdfs</a> <a href="/tags/hive/" style="font-size: 12.5px;">hive</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/jodatime/" style="font-size: 10px;">jodatime</a> <a href="/tags/kafka/" style="font-size: 11.25px;">kafka</a> <a href="/tags/kerberos/" style="font-size: 12.5px;">kerberos</a> <a href="/tags/linux/" style="font-size: 18.75px;">linux</a> <a href="/tags/mac/" style="font-size: 11.25px;">mac</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/mongo/" style="font-size: 10px;">mongo</a> <a href="/tags/postgres/" style="font-size: 10px;">postgres</a> <a href="/tags/quartz/" style="font-size: 10px;">quartz</a> <a href="/tags/sbt/" style="font-size: 10px;">sbt</a> <a href="/tags/scala/" style="font-size: 12.5px;">scala</a> <a href="/tags/schedule/" style="font-size: 11.25px;">schedule</a> <a href="/tags/sentry/" style="font-size: 10px;">sentry</a> <a href="/tags/shell/" style="font-size: 17.5px;">shell</a> <a href="/tags/spark/" style="font-size: 13.75px;">spark</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/vim/" style="font-size: 11.25px;">vim</a> <a href="/tags/yarn/" style="font-size: 12.5px;">yarn</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/06/read-file-in-jar/">读取jar包中文件</a>
          </li>
        
          <li>
            <a href="/2016/10/26/shudown-kafka-broker/">主动下线kafka broker</a>
          </li>
        
          <li>
            <a href="/2016/10/26/spark-job-server/">Spark jobserver的安装和使用</a>
          </li>
        
          <li>
            <a href="/2016/10/20/use-local-maven-repository-faster-sbt/">使用本地maven私服加速sbt下载</a>
          </li>
        
          <li>
            <a href="/2016/10/20/use-mongo-spark-connector/">mongo-spark-connector使用说明</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="" target="_blank">作者</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 wzktravel<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
      .
      <span id="busuanzi_container_site_pv" style="display:none">view <span id="busuanzi_value_site_pv"></span> times</span>
    </div>
  </div>
</footer>

  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"wzktravel"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/script.js"></script>

</div>
</body>
</html>
