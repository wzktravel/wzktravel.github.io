
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>CDH禁用kerberos | wzktravel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="在CDH中如何禁用kerberos，以及在这个过程中遇到的一些问题和具体解决方法。">
<meta property="og:type" content="article">
<meta property="og:title" content="CDH禁用kerberos">
<meta property="og:url" content="http://wzktravel.github.io/2016/03/05/2016-03-05-Disable-kerberos-in-CDH/index.html">
<meta property="og:site_name" content="wzktravel">
<meta property="og:description" content="在CDH中如何禁用kerberos，以及在这个过程中遇到的一些问题和具体解决方法。">
<meta property="og:updated_time" content="2016-07-14T03:16:31.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CDH禁用kerberos">
<meta name="twitter:description" content="在CDH中如何禁用kerberos，以及在这个过程中遇到的一些问题和具体解决方法。">
  
    <link rel="alternative" href="/atom.xml" title="wzktravel" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">wzktravel</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="wzktravel.github.io">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-2016-03-05-Disable-kerberos-in-CDH" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/05/2016-03-05-Disable-kerberos-in-CDH/" class="article-date">
  <time datetime="2016-03-05T02:23:51.000Z" itemprop="datePublished">2016-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      CDH禁用kerberos
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在CDH中如何禁用kerberos，以及在这个过程中遇到的一些问题和具体解决方法。<br><a id="more"></a></p>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><ol>
<li>Hbase修改<code>hbase.security.authentication</code>为<code>simple</code>，取消勾选<code>hbase.security.authorization</code></li>
<li>HDFS修改<code>hadoop.security.authentication</code>为<code>simple</code>，取消勾选<code>hadoop.security.authorization</code>，将datanode的<code>dfs.datanode.address</code>恢复为<code>50010</code>，<code>dfs.datanode.http.address</code>恢复为<code>50075</code></li>
<li>Zookeeper取消勾选<code>enableSecurity</code></li>
<li>Hue实例中删除<code>Kerberos Ticket Renewer</code></li>
<li>重启集群前，手动将zookeeper /hbase下所有znode权限设置为<code>world:anyone:cdrwa</code>。使用hbase账号，然后在<code>hbase zkcli</code>中进行修改。如果启动zkcli时报jline相关错误，只需将zookeeper/lib目录下0.9版本删除，然后拷贝1.1.2版本到此目录即可解决。</li>
</ol>
<h3 id="异常信息"><a href="#异常信息" class="headerlink" title="异常信息"></a>异常信息</h3><h4 id="1-datanodes无法启动"><a href="#1-datanodes无法启动" class="headerlink" title="1. datanodes无法启动"></a>1. datanodes无法启动</h4><p>异常信息: </p>
<p></p><p><code>java.io.IOException: Failed on local exception: java.net.SocketException: Permission denied; Host Details : local host is: &quot;xxxxx&quot;; destination host is: (unknown)</code></p>
<p>解决方法: </p>
<p></p><p>将datanode的<code>dfs.datanode.address</code>恢复为<code>50010</code>，<code>dfs.datanode.http.address</code>恢复为<code>50075</code>。</p>
<h4 id="2-禁用kerberos后-hbase无法启动"><a href="#2-禁用kerberos后-hbase无法启动" class="headerlink" title="2. 禁用kerberos后, hbase无法启动"></a>2. 禁用kerberos后, hbase无法启动</h4><p>异常信息: </p>
<p></p><p>禁用kerberos后，重启hbase时报<code>Authentication is not valid : /hbase</code>错误</p>
<p>原因:</p>
<p></p><p>zookeeper和hbase启用kerberos后，<code>/hbase</code>目录权限属于hbase。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[zk: vlnx103124:2181(CONNECTED) 0] getAcl /hbase/table/tsdb</div><div class="line">&apos;world,&apos;anyone</div><div class="line">: r</div><div class="line">&apos;sasl,&apos;hbase</div><div class="line">: cdrwa</div></pre></td></tr></table></figure></p>
<p>解决方案:</p>
<p></p><p>重新启用kerberos，然后手动将zookeeper中/hbase下所有znode权限设置为<code>world:anyone:cdrwa</code>。<br>使用hbase账号，然后在<code>hbase zkcli</code>中进行修改。如果启动zkcli时报jline相关错误，只需将zookeeper/lib目录下0.9版本删除，然后拷贝1.1.2版本到此目录即可解决。</p>
<blockquote>
<p>backing out kerberos is not an automatic process currently as there can be many services using Zookeeper and it retains those ACLs which were set while kerberos was enabled. We have developed a little java program for our customers that backs out the ACLs from ZK, but all it really does is iterate over all the znodes in /hbase and set their acls to world:anyone.</p>
<p>So, you can just manually do this as well. This is an example:<br><code>setAcl /hbase world:anyone:cdrwa</code><br>You would need to do that on every znode under /hbase and the master will start.</p>
</blockquote>
<p>参考:</p>
<ol>
<li><a href="https://support.pivotal.io/hc/en-us/articles/202017243-HBase-fails-to-start-with-an-error-NoAuth-for-hbase-unassigned-1028785192-" target="_blank" rel="external">HBase fails to start with an error “NoAuth for /hbase/</a></li>
<li><a href="https://www.zybuluo.com/xtccc/note/181910" target="_blank" rel="external">Disabling Kerberos for CDH</a> </li>
<li><a href="http://community.cloudera.com/t5/Storage-Random-Access-HDFS/how-to-remove-a-node-in-zookeeper-forcibly/m-p/8278" target="_blank" rel="external">how to remove a node in zookeeper, forcibly ?</a></li>
</ol>
<h4 id="3-禁用kerberos后，HA情况下yarn两个ResourceManager都处于standby状态"><a href="#3-禁用kerberos后，HA情况下yarn两个ResourceManager都处于standby状态" class="headerlink" title="3. 禁用kerberos后，HA情况下yarn两个ResourceManager都处于standby状态"></a>3. 禁用kerberos后，HA情况下yarn两个ResourceManager都处于standby状态</h4><p>在不打patch的情况下还未解决，但是可以禁用HA，只启用单个节点。<br>参考<a href="https://issues.apache.org/jira/browse/YARN-2588" target="_blank" rel="external">https://issues.apache.org/jira/browse/YARN-2588</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://wzktravel.github.io/2016/03/05/2016-03-05-Disable-kerberos-in-CDH/" data-id="ciqlv6twe001mpo9kqohpv529" class="article-share-link">分享到</a>
      

      
        <a href="http://wzktravel.github.io/2016/03/05/2016-03-05-Disable-kerberos-in-CDH/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CDH/">CDH</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kerberos/">kerberos</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/03/31/2016-03-31-Fix-Corrupt-Blocks-on-HDFS/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          查看修复HDFS中丢失的块
        
      </div>
    </a>
  
  
    <a href="/2016/03/01/2016-03-01-how-to-use-kerberos-in-CDH/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">kerberos使用手册</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="2016/03/05/2016-03-05-Disable-kerberos-in-CDH/" data-title="CDH禁用kerberos" data-url="http://wzktravel.github.io/2016/03/05/2016-03-05-Disable-kerberos-in-CDH/"></div>
  </section>
</section>
      
      <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDH/">CDH</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awk/">awk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azkaban/">azkaban</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cdh/">cdh</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloudera/">cloudera</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdfs/">hdfs</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/">jvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kerberos/">kerberos</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda/">lambda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log/">log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lzo/">lzo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ntp/">ntp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/quartz/">quartz</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/queue/">queue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sed/">sed</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sentry/">sentry</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/">spark</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yarn/">yarn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/任务调度/">任务调度</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程/">多线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/调度/">调度</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CDH/" style="font-size: 15px;">CDH</a> <a href="/tags/awk/" style="font-size: 10px;">awk</a> <a href="/tags/azkaban/" style="font-size: 10px;">azkaban</a> <a href="/tags/cdh/" style="font-size: 11.67px;">cdh</a> <a href="/tags/cloudera/" style="font-size: 11.67px;">cloudera</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/flume/" style="font-size: 11.67px;">flume</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 11.67px;">github</a> <a href="/tags/hadoop/" style="font-size: 20px;">hadoop</a> <a href="/tags/hdfs/" style="font-size: 13.33px;">hdfs</a> <a href="/tags/hive/" style="font-size: 11.67px;">hive</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/jvm/" style="font-size: 10px;">jvm</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/kerberos/" style="font-size: 13.33px;">kerberos</a> <a href="/tags/lambda/" style="font-size: 10px;">lambda</a> <a href="/tags/linux/" style="font-size: 16.67px;">linux</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/lzo/" style="font-size: 10px;">lzo</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/ntp/" style="font-size: 10px;">ntp</a> <a href="/tags/quartz/" style="font-size: 10px;">quartz</a> <a href="/tags/queue/" style="font-size: 10px;">queue</a> <a href="/tags/scala/" style="font-size: 13.33px;">scala</a> <a href="/tags/sed/" style="font-size: 10px;">sed</a> <a href="/tags/sentry/" style="font-size: 10px;">sentry</a> <a href="/tags/shell/" style="font-size: 18.33px;">shell</a> <a href="/tags/spark/" style="font-size: 13.33px;">spark</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/vim/" style="font-size: 11.67px;">vim</a> <a href="/tags/yarn/" style="font-size: 10px;">yarn</a> <a href="/tags/任务调度/" style="font-size: 10px;">任务调度</a> <a href="/tags/多线程/" style="font-size: 10px;">多线程</a> <a href="/tags/调度/" style="font-size: 10px;">调度</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/05/24/2016-05-24-upgrade-cdh-to-5-7-0/">升级CDH到5.7.0</a>
          </li>
        
          <li>
            <a href="/2016/05/11/2016-05-11-elasticsearch-reindex/">elasticsearch修改mapping重建索引</a>
          </li>
        
          <li>
            <a href="/2016/05/10/2016-05-10-hadoop-management/">hadoop集群管理</a>
          </li>
        
          <li>
            <a href="/2016/05/04/2016-05-04-azkaban-how-to-install-and-use/">azkaban的安装和使用</a>
          </li>
        
          <li>
            <a href="/2016/04/14/2016-04-14-quartz-in-practice/">quartz in practice</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 wzktravel<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"wzktravel"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/script.js"></script>

</div>
</body>
</html>
